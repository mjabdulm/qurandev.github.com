corpusdata.html

<script src="lib/jquery-1.7.min.js" language="javascript" type="text/javascript" ></script>
<script src="js/GlobalQuran.js?v=3.4"></script>
<script src='js/xregexp.js' ></script>

<script>
var gq = {
    ds1: [], ds2: [], ds3: [], ds4: [], dsroot: [], dslem: [],
    loadedEMPTYQURANJSON: false, 
    loadedPercent: 0,
    loadedPart1: false,    loadedPart2: false, loadedPart3: false,
    loaded: false,

    cookdata: function(type, _DATA){ //NOTE: CURRENTLY parameters are not being used in existing code. REFACTOR NEEDED!!
        console.log('cookdata called - ' + type + '\t' + (_DATA ? _DATA.length : '-') ); 
        if(gq.loaded) return; var parts = [gq.MANZIL1, gq.MANZIL234, gq.MANZIL56, gq.MANZIL7], test = true;
        $.each(parts, function(manzilno, MANZIL){
            if(typeof(MANZIL) == 'undefined' || MANZIL.length < 500) test = false;
        }); if(test) gq.loaded = true; else return;
        var words = [], tokens = [], tmp = [], lines;
        $.each(parts, function(manzilno, MANZIL){
            if( MANZIL ){
                $.each(MANZIL.slice(1), function(lineno, line){ lines = {};
                    $.each(words = line.split('★'), function(wordno, word){
                        $.each(tokens = word.split('⚓'), function(tokenno, token){ if(token){ 
                            token = $.trim(token); lines[tokenno] ? (lines[tokenno].push(token) ): (lines[tokenno] = [token]) };
                        });                    
                    });
                    gq.ds1.push( lines[0].join(' ') ); gq.ds2.push( lines[1].join('$') ); 
                    //N|LEM:{som|ROOT:smw|M|GEN PN|LEM:{ll~ah|ROOT:Alh|GEN ADJ|LEM:r~aHoma`n|ROOT:rHm|MS|GEN ADJ|LEM:r~aHiym|ROOT:rHm|MS|GEN
                    var line2, line = lines[2].join(' '); gq.ds3.push( line ); 
                    line2 = line.replace(/\|LEM:[^\|]*/g, '').replace(/\|ROOT:[^\|]*/g, ''); gq.ds4.push( line2 );

                    var tokens = ['LEM:', 'ROOT:'], ds = ['', ''];
                    $.each(tokens, function(tokenno, token){
                        $.each(lines[2], function(lineno, line){
                            if(line.indexOf(token) == -1){ ds[tokenno] += '- '; }
                            else{ line = line.split( token )[1];
                                if(!line.indexOf('|') == -1){ alert('no pipe sep: ' + line); debugger; }//check for | ??
                                line = line.split('|')[0]; 
                                ds[tokenno] += line + ' ';//console.log(data + data1); 
                            }
                        });
                    });
                    //TODO: put back this. gq.dslem.push( $.trim(ds[0] ) ); gq.dsroot.push( $.trim(ds[1] ) );
                    gq.dslem.push( (ds[0] ) ); gq.dsroot.push( (ds[1] ) );
                });
            };
        });
    },
    
    display: function(_keyword, type, obj){ 
        $('#'+ type).val( _keyword +'\n' + (!obj ? '-' : JSON.stringify(obj) ) );
        //!obj[_keyword][type] ? "-" : obj[type].d );
    },

    typesArray: ["buck", "bare", "lem", "root", "word", "corpus"],
    
    displayReset: function(){ 
        $.each(gq.typesArray, function(typeno, type){
            $('#'+type).val('...');
        });
    },
    
    search: function(_keyword){ gq.displayReset(); if( (!_keyword) || (_keyword.length <= 2) ) return; 
        var regexp, result = {}, type, obj, keyword = escapeRegex(_keyword); result[ _keyword ] = {};
        type = "buck"; regexp = new RegExp(".*(?:" + keyword + ").*", "g");
        obj = result[_keyword][ type ] = gq.search2(keyword, regexp, prefixLineno(gq.ds1) ); gq.display(_keyword, type, obj);
        type = "bare"; regexp = new RegExp(".*(?:" + BuckToBare(keyword) + ").*", "g");
        obj = result[_keyword][type] = gq.search2(keyword, regexp, prefixLineno( BuckToBare( gq.ds1.join('\n') ).split('\n') ) );  gq.display(_keyword, type, obj);

        type = "lem"; regexp = new RegExp(".*(?:" + keyword + ").*", "g");
        obj = result[_keyword][type] = gq.search2(keyword, regexp, prefixLineno(gq.dslem) ); gq.display(_keyword, type, obj);

        type = "root"; regexp = new RegExp(".*(?:" + keyword + ").*", "g");
        obj = result[_keyword][ type ] = gq.search2(keyword, regexp, prefixLineno(gq.dsroot) ); gq.display(_keyword, type, obj);
        
        type = "word"; regexp = new RegExp(".*(?:" + keyword + ").*", "gi"); //RegExp(".*" + escapeRegex(token) + ".*", "gi");
        obj = result[_keyword][ type ] = gq.search2(keyword, regexp, prefixLineno(gq.ds2) ); gq.display(_keyword, type, obj);
        
        //type = "corpusFULL"; regexp = new RegExp(".*(?:" + keyword + ").*", "gi");
        //obj = result[_keyword][ type ] = gq.search2(keyword, regexp, prefixLineno(gq.ds3) ); gq.display(_keyword, type, obj);
        
        type = "corpus"; regexp = new RegExp(".*(?:" + keyword + ").*", "gi");
        obj = result[_keyword][ type ] = gq.search2(keyword, regexp, prefixLineno(gq.ds4) ); gq.display(_keyword, type, obj);
        
        console.log( JSON.stringify( result ) );
        return result;
    },
    
    search2: function(word, regexp, DATA){ var o = {}, results, timeBaseline = new Date().getTime(), timeDone;
        results = DATA.match(regexp); o["n"] = (!results) ? 0 : results.length; 
        if(results) $.each(results, function(hitno, hit){
            results[hitno] = parseInt( results[hitno].split('|')[0] );
        }); timeDone = new Date().getTime(); o["t"] = timeDone - timeBaseline;
        o["d"] = results; return o;
    }

}
var prefixLineno = function(DATAarr){ if(!DATAarr) return; var out = []; 
    $.each(DATAarr, function(lineno, line){
        out.push(lineno + '|'+ line);
    });
    return out.join('\n');
}

var escapeRegex = function (str) {
        return str.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
}
var BuckToBare = function(str){ if(!str) return;
    str = str.replace(/[{`><]/g, 'A').replace(/[\&]/g, 'w').replace(/[}]/g, 'y').replace( /[\FNK#aeiou~\^]/g, '');
    return str;
}

</script>

<H4>&nbsp;&nbsp;</H4>
<input id=keyword onkeyup="gq.search($('#keyword').val() )" value=rHm /><BR/><BR/>
<textarea id=buck rows=30 columns=100></textarea>
<textarea id=bare rows=30 columns=100></textarea>
<textarea id=lem rows=30 columns=100></textarea>
<textarea id=word rows=30 columns=100></textarea>
<textarea id=corpus rows=30 columns=100></textarea>
<textarea id=corpusFULL rows=30 columns=100></textarea>
<script src=data/manzil1,7.js></script>
<script src=data/manzil5,6.js></script>
<script src=data/manzil2,3,4.js></script>

<script src=data/qRoot.txt_script.js></script>
<script src=data/qLem.txt_script.js></script>
<script src=data/qTranslit.txt_script.js></script>
<script src=data/qWord.txt_script.js></script>
<script src=data/qCorpus.txt_script.js></script>
<script src=data/qBare.txt_script.js></script>
<script src=data/qBuck.txt_script.js></script>
​